<script type="text/javascript" src="/resources/scripts/node_modules/lockr/lockr.min.js"></script>
<script type="text/javascript" src="/resources/scripts/node_modules/axios/dist/axios.min.js"></script>
<script type="text/javascript" src="/resources/scripts/node_modules/vue/dist/vue.js"></script>
<script type="text/javascript" src="/resources/scripts/swf/js/entity_helper.js"></script>

<link href="/fragments/css/mandi.css" rel="stylesheet">
<script type="text/javascript" src="/fragments/js/util.js" ></script>
<script type="text/javascript">
    var profile = null;

    $(function () {
        $("#header").load("/fragments/html/header");

        new Vue({
            el: '#profile',
            data: {
                User: { VirtualPaymentAddress: "", DateOfBirth: "", City: { Name: "" }, PinCode: { PinCode: "" } },
                errors: [],
                userPhoneBeingEdited: false,
                userEmailBeingEdited: false,
                userAddressBeingEdited: false,
                userVpaBeingEdited: false,
                kycSelectedFileName : "",
                current: {
                    Cities: [],
                    PinCodes: [],
                    lookupselectionIndex: -1,
                }
            },
            created: function () {
                self = this;
                self.User = {};
                api().url("/users/show/" + Lockr.get("User").Id).get().then(function (response) {
                    self.User = response.User;
                    self.fixUserAttributes();
                     //!self.User.Verified || self.User.Verified === 'N' ;
                    self.showApp();
                });

            },
            methods: {
                fixUserAttributes : function(){
                    let self = this;
                    if (!self.User.City) {
                        self.User.City = {};
                    }
                    if (!self.User.PinCode) {
                        self.User.PinCode = {};
                    }
                    if (!self.User.UserPhones) {
                        self.User.UserPhones = [];
                    }
                    self.checkUserPhones();
                    if (!self.User.UserEmails) {
                        self.User.UserEmails = [];
                    }
                    //self.vmprofile.User.UserEmails.push({ "Email": "" , Validated : "N"});
                    self.checkUserEmails();
                    self.userAddressBeingEdited = false;
                    self.userVpaBeingEdited = false;
                    Lockr.set("User",self.User);
                },
                isKeyTriggerable: function (e) {
                    return (e && e.target.value.length > 3);
                },
                onCityChange: function (e) {
                    e && e.preventDefault();
                    if (!this.isKeyTriggerable(e)) {
                        return;
                    }
                    let self = this;
                    new Autocomplete("cities", e.target).search().then(function (response) {
                        if (!response) {
                            return
                        }
                        self.current.Cities = response.Cities;
                        if (self.current.Cities.length === 1) {
                            self.onCitySelect(null, self.current.Cities[0]);
                        } else {
                            self.loadLookupEntries(e.target);
                        }
                        Vue.set(self.current,"Cities",self.current.Cities);
                    });
                },
                onCitySelect: function (e, item) {
                    e && e.preventDefault();
                    let self = this;
                    self.User.City = item;
                    self.User.State = item.State;
                    self.User.Country = item.State.Country;
                    self.current.Cities = [];
                },
                onPinCodeChange: function (e) {
                    e && e.preventDefault();
                    if (!this.isKeyTriggerable(e)) {
                        return;
                    }

                    let self = this;
                    new Autocomplete("pin_codes", e.target).search("PIN_CODE").then(function (response) {
                        if (!response) {
                            return
                        }
                        if (self.User.City && self.User.City.Id){
                            self.current.PinCodes = response.PinCodes.filter(function(pc){
                                return !pc.City || pc.City.Id === self.User.City.Id
                            });
                        }else {
                            self.current.PinCodes = response.PinCodes;
                        }
                        if (self.current.PinCodes.length === 1) {
                            self.onPinCodeSelect(null, self.current.PinCodes[0]);
                        } else {
                            self.loadLookupEntries(e.target);
                        }
                    });
                },
                onPinCodeSelect: function (e, item) {
                    e && e.preventDefault();
                    let self = this;
                    self.User.PinCode = item;
                    self.current.PinCodes = [];
                },
                getParentDiv: function (element) {
                    var div = element;
                    while (div && div.tagName !== 'DIV') {
                        div = div.parentElement;
                    }
                    return div;
                },
                loadLookupEntries: function (element) {
                    var div = this.getParentDiv(element);
                    if (div) {
                        div.appendChild(this.$refs['lookupEntries']);
                    }
                },

                navigate: function (e, index, length) {
                    e && e.preventDefault();
                    let self = this;
                    this.current.lookupselectionIndex = (index % length);
                    let anchors = this.$refs['lookupEntries'].getElementsByTagName("a");
                    anchors[this.current.lookupselectionIndex].focus();
                },
                saveUser: function (e) {
                    e && e.preventDefault();
                    self = this;
                    self.errors = [];
                    if (!self.User.LongName) {
                        self.errors.push("Let us know your full name.");
                    }

                    if (self.errors && self.errors.length === 0) {
                        api().url("/users/save").parameters({ "User": self.User }).post().then(function (response) {
                            self.User = response.Users[0];
                            self.fixUserAttributes();
                        });
                    }
                },
                onAadharKycFileChange: function (e) {
                    e.preventDefault();
                    let self = this;
                    self.kycSelectedFileName = e.target.files[0].name;
                },
                doAadharKyc: function (e) {
                    if (e) {
                        e.preventDefault();
                    }
                    var files = $("#aadharzipfile")[0].files;
                    if (!files.length) {
                        return;
                    }
                    var aadharzipfile = files[0];
                    var password = $("#aadharzippassword").val();

                    let self = this;
                    this.createDataFile(aadharzipfile, function (datafile) {
                        let formData = new FormData();
                        formData.append('zipfile', datafile);
                        formData.append('password', password);
                        api().url("/users/doAadharKyc").parameters(formData).headers({ "Content-Type": "multipart-formdata" }).post().then(function (response) {
                            console.log(response);
                            self.User = response.User;
                            self.fixUserAttributes();
                        });
                    });
                },
                createDataFile: function (file, callback) {
                    var reader = new FileReader();
                    reader.onload = (e) => {
                        callback(e.target.result);
                    }
                    reader.readAsDataURL(file);
                },

                verifyPhone: function (userPhone) {
                    self = this;
                    self.errors = [];
                    api().url("/user_phones/validateOtp/" + userPhone.Id).parameters({ "Otp": userPhone.Otp }).post().then(function (response) {
                        if (response.UserPhone.Validated === 'Y') {
                            index = self.User.UserPhones.findIndex(function (currentValue) {
                                return currentValue.Id === userPhone.Id;
                            });
                            self.User.UserPhones.splice(index, 1, response.UserPhone);
                            self.checkUserPhones();
                        } else {
                            self.errors.push("Otp doesnot match");
                        }

                    });
                },

                makePrimaryPhone: function (userPhone) {
                    self = this;
                    self.errors = [];
                    if (!userPhone.Validated || userPhone.Validated !== 'Y') {
                        self.errors.push("Only validated phone numbers can be made as primary phone number.");
                    }
                    if (self.errors.length === 0) {
                        api().url("/users/save").parameters({ "User": { "Id": self.User.Id, "PhoneNumber": userPhone.PhoneNumber } }).post().then(function (response) {
                            self.User = response.Users[0];
                            self.fixUserAttributes();
                        }).catch(function (err) {
                            self.errors.push(err.response.data.SWFHttpResponse.Error)
                        });
                    }
                },
                destroyPhone: function (userPhone) {
                    let self = this;
                    api().url("/user_phones/destroy/" + userPhone.Id).get().then(function (response) {
                        index = self.User.UserPhones.findIndex(function (currentValue) {
                            return currentValue.Id === userPhone.Id;
                        });
                        self.User.UserPhones.splice(index, 1);
                        self.checkUserPhones();
                    });

                },
                checkUserPhones: function () {
                    let self = this;
                    let allPhonesValidated = self.User.UserPhones.filter(user => user.Validated && user.Validated === 'N').length ? false : true;
                    self.userPhoneBeingEdited = !allPhonesValidated
                    if (allPhonesValidated) {
                        if (self.User.UserPhones.filter(p => p.PhoneNumber === "").length === 0) {
                            self.User.UserPhones.push({ "PhoneNumber": "" });
                        }
                    }
                },
                addPhone: function (userPhone) {
                    self = this;
                    api().url("/user_phones/save").parameters({ "UserPhone": { "PhoneNumber": userPhone.PhoneNumber, "UserId": self.User.Id } }).post().then(function (response) {
                        index = self.User.UserPhones.findIndex(function (currentValue) {
                            return !currentValue.Id;
                        });
                        self.User.UserPhones.splice(index, 1, response.UserPhones[0]);
                        self.checkUserPhones();
                    });
                },
                viewAddPhone: function (status) {
                    this.userPhoneBeingEdited = status;
                },
                viewAddVPA: function (status) {
                    this.userVpaBeingEdited = status;
                },
                verifyEmail: function (userEmail) {
                    self = this;
                    self.errors = [];
                    api().url("/user_emails/validateOtp/" + userEmail.Id).parameters({ "Otp": userEmail.Otp }).post().then(function (response) {
                        if (response.UserEmail.Validated === 'Y') {
                            index = self.User.UserEmails.findIndex(function (currentValue) {
                                return currentValue.Id === userEmail.Id;
                            });
                            self.User.UserEmails.splice(index, 1, response.UserEmail);
                            self.checkUserEmails();
                        } else {
                            self.errors.push("Otp doesnot match");
                        }
                    });
                },
                makePrimaryEmail: function (userEmail) {
                    self = this;
                    self.errors = [];
                    if (!userEmail.Validated || userEmail.Validated !== 'Y') {
                        self.errors.push("Only validated emails can be made as primary email.");
                    }
                    if (self.errors.length === 0) {
                        api().url("/users/save").parameters({ "User": { "Id": self.User.Id, "Email": userEmail.Email } }).post().then(function (response) {
                            self.User = response.Users[0];
                            self.fixUserAttributes();
                        });
                    }
                },
                destroyEmail: function (userEmail) {
                    self = this;
                    api().url("/user_emails/destroy/" + userEmail.Id).get().then(function (response) {
                        index = self.User.UserEmails.findIndex(function (currentValue) {
                            return currentValue.Id === userEmail.Id;
                        });
                        self.User.UserEmails.splice(index, 1);
                        self.checkUserEmails();
                    });
                },
                checkUserEmails: function () {
                    let self = this;
                    let allEmailsValidated = self.User.UserEmails.filter(user => user.Validated && user.Validated === 'N').length ? false : true;
                    self.userEmailBeingEdited = !allEmailsValidated
                },
                addEmail: function (userEmail) {
                    self = this;
                    api().url("/user_emails/save").parameters({ "UserEmail": { "Email": userEmail.Email, "UserId": self.User.Id } }).post().then(function (response) {
                        index = self.User.UserEmails.findIndex(function (currentValue) {
                            return !currentValue.Id;
                        });
                        self.User.UserEmails.splice(index, 1, response.UserEmails[0]);
                        self.checkUserEmails();
                    });
                },
                viewAddEmail: function (status) {
                    let self = this;
                    if (!self.userEmailBeingEdited && status) {
                        self.User.UserEmails.push({ "Email": "", Validated: "N" });
                        this.userEmailBeingEdited = status;
                    } else {
                        self.User.UserEmails.pop();
                        this.userEmailBeingEdited = status;
                    }
                },
                editAddress: function (event) {
                    let self = this;
                    if (event) {
                        event.preventDefault();
                    }
                    self.userAddressBeingEdited = true;
                },
                cancelEditAddress: function (event) {
                    let self = this;
                    if (event) {
                        event.preventDefault();
                    }
                    self.userAddressBeingEdited = false;
                },
                verify: function (event) {
                    let self = this;
                    api().url("/users/verify/" + self.User.Id).get().then(function (response) {
                        self.User = response.User;
                        Lockr.set("User", self.User);
                    });
                },

                showApp: function () {
                    $("#pageTitle").html("Manage Profile");
                    $("#root").show();
                }
            }
        });
    });
</script>
<div id="root" style="display:none;">
    <!-- Header fragrament -->
    <div id="header">
    </div>
    <!-- body content -->
    <div id="profile" class="app-body" v-if="User.Id">
        <div class="container-fluid">
            <!-- HBO Banlance -->
            <div class="row">
                <div class="col">
                    <h6 class="mt-3">Humbhi Online Subscription</h6>
                </div>
            </div>
            <div class="content-box">
                <div class="row">
                    <div class="col-7  d-flex align-items-center">
                        <span v-if="User.BalanceOrderLineCount <= 0">
                            Zero Balance
                        </span>
                        <span v-else-if="User.BalanceOrderLineCount <= 10">
                            Low Balance ({{User.BalanceOrderLineCount}})
                        </span>
                        <span v-else>
                            Balance ({{User.BalanceOrderLineCount}})
                        </span>
                    </div>
                    <div class="col-5 d-flex justify-content-end">
                        <a class="btn btn-primary btn-sm" href="/dashboard?search=HBO Subscription">
                            Recharge
                        </a>
                    </div>
                </div>
            </div>
            <!-- Home Address -->
            <div class="row">
                <div class="col">
                    <h6 class="mt-3">Home</h6>
                </div>
                <div class="col text-right" v-if="User.Verified && User.Verified === 'Y'">
                    <span class="mt-3 d-inline-block"><i class="fas fa-check mr-2"></i>Verified</span>
                </div>
            </div>
            <div class="content-box">
                <div class="row">
                    <div class="col">
                        <a href="#" class="btn-close fas fa-edit" v-if="!userAddressBeingEdited"
                            @click="editAddress($event)"></a>
                        <h6 class="m-0">{{User.LongName}}</h6>
                        <p class="m-0 text-muted">
                            <span v-if="User.AddressLine1">{{User.AddressLine1}},</span>
                            <span v-if="User.AddressLine2">{{User.AddressLine2}},</span>
                            <span v-if="User.AddressLine3">{{User.AddressLine3}},</span>
                            <span v-if="User.AddressLine4">{{User.AddressLine4}},</span>
                            <span
                                v-if="User.City && User.State && User.City.Name && User.State.Name">{{User.City.Name}}-{{User.State.Name}},</span>
                            <span v-if="User.PinCode.PinCode">{{User.PinCode.PinCode}}</span>
                        </p>
                    </div>
                </div>
            </div>
            <!-- Kyc Option -->
            <div class="row" v-if="!User.Verified || User.Verified === 'N'">
                <div class="col">
                    <h6 class="mt-4 d-inline-block">KYC : Aadhar Upload</h6>
                </div>
            </div>
            <div class="content-box" v-if="!User.Verified || User.Verified === 'N'">
                <div class="form-row">
                    <div class="col">
                        <div class="form-row no-gutters">
                            <div class="col-12">
                                <input type="file" class="file-upload" id="aadharzipfile" v-on:input="onAadharKycFileChange($event)"/>
                                <label class="btn btn-sm btn-primary" for="aadharzipfile">
                                    {{ kycSelectedFileName && kycSelectedFileName.length > 0 ? kycSelectedFileName :
                                        "Click to Select Aadhar KYC"}}
                                </label>
                            </div>
                            <div class="col-8">
                                <input id="aadharzippassword" class="form-control form-control-sm" type="password"
                                    placeholder="Password" />
                            </div>
                            <div class="col-4 text-right">
                                <a href="#" class="btn btn-sm btn-block btn-primary" role="button" title="Upload"
                                    v-on:click="doAadharKyc($event)">
                                    Upload
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Payment Option -->
            <div class="row">
                <div class="col">
                    <h6 class="mt-4 d-inline-block">Payment Option</h6>
                </div>
                <div class="col d-flex justify-content-end align-items-end">
                    <a href="#/" class="btn-close fas fa-edit mb-3" role="button" v-on:click="viewAddVPA(true)"
                        v-if="!userVpaBeingEdited">

                    </a>
                </div>
            </div>
            <div class="content-box">
                <div class="row">
                    <div class="col">
                        <p class="mb-0 text-muted">UPI ID **</p>
                        <p class="mb-0">{{User.VirtualPaymentAddress}}</p>
                    </div>
                    <div class="col">
                        <p class="mb-0 text-muted">Name As In Bank</p>
                        <p class="mb-0">{{User.NameAsInBankAccount}}</p>
                    </div>
                </div>
            </div>
            <div class="row" v-if="userVpaBeingEdited">
                <div class="col">
                    <div class="content-sub-box">
                        <div class="form-row mb-2">
                            <div class="col">
                                <!-- <label class="mb-0 text-muted" for="vpa">UPI ID **</label> -->
                                <input class="form-control form-control-sm" id="vpa"
                                    v-model="User.VirtualPaymentAddress" placeholder="UPI/Payment Address" />
                            </div>
                            <div class="col">
                                <!-- <label class="mb-0 text-muted" for="bankname">Name As In Bank</label> -->
                                <input class="form-control form-control-sm" id="bankname"
                                    v-model="User.NameAsInBankAccount" placeholder="Name As In Bank" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col text-center">
                                <button class="btn btn-light btn-sm" type="button"
                                    v-on:click="viewAddVPA(false)">Cancel</button>
                                <button class="btn btn-primary btn-sm" type="submit" v-on:click="saveUser($event)">
                                    {{User.VirtualPaymentAddress && User.NameAsInBankAccount?"Update":"Submit"}}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <p class="text-note text-muted mb-3">** Your virtual payment Address would be used to receive payments into
                your
                bank account.
                Please enter this correctly.
                Entering incorrectly can cause money to reach some one else's account.</p>
            <!-- Mobile Update -->
            <div class="row">
                <div class="col">
                    <h6 class="mt-3 d-inline-block">Mobile Number</h6>
                </div>
                <div class="col d-flex justify-content-end align-items-end">
                    <button class="btn btn-sm btn-outline-primary mb-1" v-if="!userPhoneBeingEdited"
                        v-on:click="viewAddPhone(true)">+ New
                        Mobile</button>
                </div>
            </div>
            <div class="content-box">
                <div class="data-list user-list" v-if="User.UserPhones.length !== 0">
                    <div class="form-row" v-if="userPhone.Id && userPhone.Validated && userPhone.Validated === 'Y'"
                        v-for="(userPhone,index) in User.UserPhones">
                        <div class="col">
                            {{userPhone.PhoneNumber}}
                        </div>
                        <div class="col-4 text-right text-success" v-if="userPhone.PhoneNumber === User.PhoneNumber">
                            <small class="text-success">
                                Default
                            </small>
                        </div>
                        <div class="col-8 text-right"
                            v-if="(userPhone.Validated && userPhone.Validated === 'Y') && userPhone.PhoneNumber !== User.PhoneNumber">
                            <small><a href="#" role="button" v-on:click="makePrimaryPhone(userPhone)">
                                    Make as Default <i class="ml-2 fas fa-trash-alt"
                                        v-on:click="destroyPhone(userPhone)"></i>
                                </a></small>
                        </div>
                    </div>
                </div>
                <div class="text-muted" v-if="User.UserPhones.length === 0">Mobile is not registered.</div>
            </div>
            <div class="row" v-if="userPhoneBeingEdited">
                <div class="col">
                    <div class="content-sub-box">
                        <div v-for="(userPhone,index) in User.UserPhones">
                            <a class="btn-close fa fa-times" v-on:click="destroyPhone(userPhone)"></a>
                            <div v-if="userPhone.Id && userPhone.Validated && userPhone.Validated === 'N'">
                                <p class="text-muted mb-1">OTP sent to {{userPhone.PhoneNumber}}</p>
                                <div class="form-row">
                                    <div class="col">
                                        <input v-bind:id="'otp-'+index" class="form-control form-control-sm"
                                            v-model="userPhone.Otp" placeholder="Otp" />
                                    </div>
                                    <div class="col-3 verify-phone">
                                        <a class="btn btn-block btn-sm btn-primary" href="#" role="button"
                                            v-on:click="verifyPhone(userPhone)">
                                            Verify
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div v-if="!userPhone.Id">
                                <a class="btn-close fa fa-times" v-on:click="viewAddPhone(false)"></a>
                                <p class="text-muted mb-1">
                                    Enter Your Other Mobile No.
                                </p>
                                <div class="form-row">
                                    <div class="col">
                                        <input v-bind:id="'phone-'+index" class="form-control form-control-sm"
                                            v-model="userPhone.PhoneNumber" placeholder="Mobile number" />
                                    </div>
                                    <div class="col-4">
                                        <a class="btn btn-block btn-sm btn-primary" href="#" role="button"
                                            v-on:click="addPhone(userPhone)">
                                            Get OTP
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Email Update -->
            <div class="row">
                <div class="col">
                    <h6 class="mt-4 d-inline-block">Email</h6>
                </div>
                <div class="col d-flex justify-content-end align-items-end">
                    <button class="btn mb-1 btn-sm btn-outline-primary" v-if="!userEmailBeingEdited"
                        v-on:click="viewAddEmail(true)">+ New
                        Email</button>
                </div>
            </div>
            <div class="content-box">
                <div class="data-list user-list" v-if="User.UserEmails.length !== 0">
                    <div class="row py-2 border-top"
                        v-if="userEmail.Id && userEmail.Validated && userEmail.Validated === 'Y'"
                        v-for="(userEmail,index) in User.UserEmails">
                        <div class="col-4">
                            {{userEmail.Email}}
                        </div>
                        <div class="col-8 text-right" v-if="userEmail.Email === User.Email">
                            <small class="text-success">
                                Default
                            </small>
                        </div>
                        <div class="col-8 text-right"
                            v-if="(userEmail.Validated && userEmail.Validated === 'Y') && userEmail.Email !== User.Email">
                            <a href="#" role="button" v-on:click="makePrimaryEmail(userEmail)">
                                Make as Default
                            </a>
                            <i class="fas fa-trash-alt" v-on:click="destroyEmail(userEmail)"></i>
                        </div>
                    </div>
                </div>
                <div class="text-muted"
                    v-if="User.UserEmails.length === 0 || (User.UserEmails.length === 1 &&  User.UserEmails[0].Validated === 'N')">
                    Email Address is not registered.</div>
            </div>
            <div class="row" v-if="userEmailBeingEdited">
                <div class="col">
                    <div class="content-sub-box">
                        <div v-for="(userEmail,index) in User.UserEmails">
                            <div v-if="userEmail.Id && (userEmail.Validated && userEmail.Validated === 'N')">
                                <a class="btn-close fas fa-times" v-on:click="destroyEmail(userEmail)"></a>
                                <p class="text-muted mb-1">OTP sent to {{userEmail.Email}}</p>
                                <div class="form-row">
                                    <div class="col">
                                        <input v-bind:id="'email-otp-'+index" class="form-control form-control-sm"
                                            v-model="userEmail.Otp" placeholder="Otp" />
                                    </div>
                                    <div class="col-3 verify-email">
                                        <a class="btn btn-block btn-sm btn-primary" href="#" role="button"
                                            v-on:click="verifyEmail(userEmail)">
                                            Verify
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div v-if="!userEmail.Id">
                                <a class="btn-close fa fa-times" v-on:click="viewAddEmail(false)"></a>
                                <p class="text-muted mb-1">Enter Your Other Email.</p>
                                <div class="form-row no-gutters">
                                    <div class="col pr-2">
                                        <input v-bind:id="'email-'+index" class="form-control form-control-sm"
                                            v-model="userEmail.Email" placeholder="Email Id" />
                                    </div>
                                    <div class="col-4">
                                        <a class="btn btn-block btn-sm btn-primary" href="#" role="button"
                                            v-on:click="addEmail(userEmail)">
                                            Get OTP
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-3"></div>
            <div id="lookupEntries" ref="lookupEntries" class="below">
                <div v-for="(city,index) in current.Cities" v-if="current.Cities.length > 0">
                    <a href="#" v-on:click="onCitySelect($event,city)" v-on:keyup.enter="onCitySelect($event,city)"
                        v-on:keyup.space="onCitySelect($event,city)"
                        v-on:keyup.up="navigate($event,index-1,current.Cities.length)"
                        v-on:keyup.down="navigate($event,index+1,current.Cities.length)">{{city.Name}} -
                        {{city.State.Name}}</a>
                </div>
                <div v-for="(pincode,index) in current.PinCodes" v-if="current.PinCodes.length > 0">
                    <a href="#" v-on:click="onPinCodeSelect($event,pincode)"
                        v-on:keyup.space="onPinCodeSelect($event,pincode)"
                        v-on:keyup.enter="onPinCodeSelect($event,pincode)"
                        v-on:keyup.up="navigate($event,index-1,current.PinCodes.length)"
                        v-on:keyup.down="navigate($event,index+1,current.PinCodes.length)">{{pincode.PinCode}} </a>
                </div>
            </div>
        </div>
        <div class="show-update" v-if="userAddressBeingEdited">
            <div class="form-row">
                <div class="col-12">
                    <h6>Update Address</h6>
                </div>
                <div class="col-12 mb-2">
                    <input class="form-control form-control-sm" id="name" v-model="User.LongName"
                        placeholder="Full Name" />
                </div>
                <div class="col-6 mb-2">
                    <input class="form-control form-control-sm" id="a1" v-model="User.AddressLine1"
                        placeholder="House Number" />
                </div>
                <div class="col-6 mb-2">
                    <input class="form-control form-control-sm" id="a2" v-model="User.AddressLine2"
                        placeholder="Building Name" />
                </div>
                <div class="col-6 mb-2">
                    <input class="form-control form-control-sm" id="a3" v-model="User.AddressLine3"
                        placeholder="Locality" />
                </div>
                <div class="col-6 mb-2">
                    <input class="form-control form-control-sm" id="a4" v-model="User.AddressLine4"
                        placeholder="Locality" />
                </div>
                <div class="col-6 mb-2">
                    <input id="city" class="form-control form-control-sm" placeholder="City Name"
                        v-model="User.City.Name" v-on:input="onCityChange($event)"
                        v-on:keyup.down="navigate($event,0,current.Cities.length)" v-if="User.City" />
                </div>
                <div class="col-6 mb-2">
                    <input id="pincode" class="form-control form-control-sm" placeholder="Pin Code"
                        v-model="User.PinCode.PinCode" v-on:input="onPinCodeChange($event)"
                        v-on:keyup.down="navigate($event,0,current.PinCodes.length)" v-if="User.PinCode" />
                </div>
                <div class="col-12 text-right">
                    <a href="#/" class="btn btn-sm btn-light mr-2" @click="cancelEditAddress($event)">Cancel</a>
                    <a href="#/" v-if="!User.Verified || User.Verified === 'Y' || User.Staff === 'N'" class="btn btn-sm btn-primary"
                        @click="saveUser($event)">Submit</a>
                    <a href="#" v-if="!User.Verified || User.Verified === 'N' && User.Staff === 'Y'" class="btn btn-sm btn-primary"
                        @click="verify($event)">Verify</a>
                </div>
            </div>
        </div>
        <div class="pop-overlay" v-if="userAddressBeingEdited"></div>
    </div>
